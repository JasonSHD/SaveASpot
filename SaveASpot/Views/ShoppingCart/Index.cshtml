@using SaveASpot.Controllers
@{
	ViewBag.Title = "Index";
	Layout = SiteConstants.Layouts.SetupAreaLayout;
}

<div class="head">
	<h4>Credit Card Information</h4>
</div>
<p>&nbsp;</p>
<form action="@Url.Action("Success","ShoppingCart")" id="payment-form" method="POST">
	<span class="payment-errors" style="color: red"></span>
	<div class="field-box">
		<label>Name on Card</label>
		<input class="span8" type="text" />
	</div>
	<div class="field-box">
		<label>Card Number</label>
		<input class="span8" type="text" size="20" data-stripe="number"/>
	</div>
	<div class="field-box">
		<label>Expiration (MM/YYYY)</label>
		<input class="span3" type="text" size="2" data-stripe="exp-month"/>
		/
		<input class="span3" type="text" size="4" data-stripe="exp-year"/>
	</div>
	<div class="field-box">
		<label>Cvc</label>
		<input class="span8" type="text" size="4" data-stripe="cvc" />
	</div>
	<div class="field-box">
		<label>Postal Code</label>
		<input class="span8" type="text" placeholder="Only required if you live in the U.S.A." />
	</div>
	<p>Please review the <a href="https://stripe.com/terms">terms of service</a>, and <a href="https://stripe.com/privacy">privacy policy</a>.</p>
	<input  id="userValidate" class ="btn btn-primary" type="button"  value="Order"/>
</form>

@*<div class="head">
	<h4>User Information</h4>
</div>
<p>&nbsp;</p>
<form>
	<div class="field-box">
		<label>User name</label>
		<input class="span8" type="text" />
	</div>
	<div class="field-box">
		<label>Email address</label>
		<input class="span8" type="text" />
	</div>
	<div class="field-box">
		<label>Password</label>
		<input class="span8" type="text" />
	</div>
	<div class="field-box">
		<label>Confirm Password</label>
		<input class="span8" type="text" />
	</div>

	<a class="btn-flat" href="javascript:sendInfo();">Order</a>
</form>*@
@*<script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
<script src="/Scripts/js/bootstrap.js" type="text/javascript"></script>
<script src="/Scripts/js/theme.js" type="text/javascript"></script>
<!-- The required Stripe lib -->
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script src="/Scripts/jquery.validate.js" type="text/javascript"></script>
<script src="/Scripts/js/saveaspot.js" type="text/javascript"></script>
<script src="/Scripts/js/saveaspot.site.js" type="text/javascript"></script>
<script src="/Scripts/js/saveaspot.site.mapTab.js" type="text/javascript"></script>*@

<script type="text/javascript">
	q(function () {
		$('#userValidate').click(function () {
			q.ajax({ url: '@Url.Action("IsPaymentInformationAdded", "Stripe")', type: "GET" }).done(function (result) {

				if (result === false) {

					Stripe.setPublishableKey('pk_test_HtOjhY9gYqhndfgX3jMUvohd');
					var $form = $('#payment-form');

					// Disable the submit button to prevent repeated clicks
					$form.find('button').prop('disabled', true);

					Stripe.createToken($form, function (status, response) {
						var $f = $form;
						if (response.error) {
							$f.find('.payment-errors').text(response.error.message);
							$form.find('button').prop('disabled', false);
						} else {
							var token = response.id;
							alert(token);
							$.ajax({ url: "@Url.Action("CreatePaymentInformation","Stripe")", type: "POST", data: { token: token } }).done(function (result) {
								$form.get(0).submit();
							});
						}
					});
				}
			});
			//e.stopPropagation();
			//return false;
		});
	});

</script>
